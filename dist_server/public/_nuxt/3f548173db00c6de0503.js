(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{314:function(t,i,e){var n=e(355);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals),(0,e(12).default)("61d59f78",n,!0,{sourceMap:!1})},354:function(t,i,e){"use strict";var n=e(314);e.n(n).a},355:function(t,i,e){(i=e(11)(!1)).push([t.i,"#globeComponentContainer{height:100%;width:100%}",""]),t.exports=i},360:function(t,i,e){"use strict";e.r(i),e(27),e(350),e(8),e(5),e(4),e(44);var n=e(18),o=(e(74),e(26)),s=e(356),a=e(357),r={data:function(){return{worldDataURL:"https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json",covidDataURLs:{confirmed:"https://covid-athenaeum.herokuapp.com/api/countries/confirmed"},isDataFetched:!1,world:void 0,worldLand:void 0,worldCountries:void 0,covidConfirmed:void 0,countryToCount:{},minCount:void 0,maxCount:void 0,canvas:void 0,context:void 0,equirectangularCanvas:void 0,equirectangularContext:void 0,colorToCountry:{},isMounted:!1,dimensions:{screenWidth:void 0,screenHeight:void 0,canvasSquareSide:void 0,canvasMargin:50},scale:void 0,rotations:{yaw:0,pitch:-10,roll:0},colors:{landRed:"225",unavailableCountry:"#8F8D8D",selectedCountry:"#F2E4E4",water:"#5CA8BF"},autoRotationDegPerSec:5,isRotating:!1,drawLoop:void 0,lastDrawLoopCallTime:void 0,isBeingDrawn:!1,selectedCountry:void 0,lastPinchDistance:void 0,dragSensitivity:75,pinchZoomSensitivity:.08,isBeingDragged:!1,nextUniqueColorSeed:1}},computed:{width:{get:function(){return this.dimensions.canvasSquareSide}},height:{get:function(){return this.dimensions.canvasSquareSide}},radius:{get:function(){return this.dimensions.canvasSquareSide/2}},projection:{get:function(){return s.e().translate([this.width/2,this.height/2]).clipAngle(90).precision(.1)}},graticule:{get:function(){return s.d()}},path:{get:function(){if(this.isMounted)return s.f(this.projection,this.context)}},equirectangularProjection:{get:function(){return s.c().translate([this.width/2,this.height/2]).scale(this.width/7)}},equirectangularPath:{get:function(){if(this.isMounted)return s.f(this.equirectangularProjection,this.equirectangularContext)}},autoRotationDegPerMilliSec:{get:function(){return this.autoRotationDegPerSec/1e3}},countryColorScale:{get:function(){return s.i().domain([this.maxCount,2e3,0]).range([0,190])}}},watch:{isDataFetched:function(){this.isDataFetched&&(console.log(this.covidConfirmed),console.log(this.world),this.setupEquirectangularColorKeys())},width:function(){this.isMounted&&(this.canvas.attr("width",this.width),this.equirectangularCanvas.attr("width",this.width),this.setupEquirectangularColorKeys())},height:function(){this.isMounted&&(this.canvas.attr("height",this.height),this.equirectangularCanvas.attr("height",this.height),this.setupEquirectangularColorKeys())},radius:function(){this.scale=this.radius},scale:function(){this.projection.scale(this.scale)},rotations:function(){this.projection.rotate([this.rotations.yaw,this.rotations.pitch,this.rotations.roll])}},beforeMount:function(){window.addEventListener("resize",this.adjustDimensions)},beforeDestroy:function(){window.removeEventListener("resize",this.adjustDimensions)},mounted:function(){console.log("DOM mounted"),console.log("Ajusting dimensions"),this.adjustDimensions(),console.log("Mounting canvas elements"),this.canvas=s.j("#canvasContainer").append("canvas").attr("id","canvas").attr("width",this.width).attr("height",this.height),this.equirectangularCanvas=s.j("#canvasContainer").append("canvas").attr("width",this.width).attr("height",this.height),this.context=this.canvas.node().getContext("2d"),this.equirectangularContext=this.equirectangularCanvas.node().getContext("2d"),this.isMounted=!0,console.log("Setting up initial projection configurations"),this.equirectangularCanvas.remove(),this.configureInitialProjection(),console.log("Attaching event listener to canvas"),this.canvas.on("mousemove",this.onMouseMove).call(s.a().on("start",this.onDragStart).on("drag",this.onDrag).on("end",this.onDragEnd)).call(s.m().on("zoom",this.onZoom)),console.log("Setting draw loop timer"),this.isRotating=!0,this.lastDrawLoopCallTime=s.h(),this.drawLoop=s.k(this.draw),console.log("Fetching data"),this.fetchInitialData()},methods:{fetchInitialData:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function i(){var e,o,s,r,c,h;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,t.isDataFetched=!1,e=t.$axios.get(t.worldDataURL),o=t.$axios.get(t.covidDataURLs.confirmed),i.next=6,Promise.all([e,o]);case 6:s=i.sent,r=Object(n.a)(s,2),c=r[0],h=r[1],t.world=c.data,t.covidConfirmed=h.data,t.worldLand=a.a(t.world,t.world.objects.land),t.worldCountries=a.a(t.world,t.world.objects.countries),t.generateCountryToCountMap(t.covidConfirmed),t.isDataFetched=!0,i.next=25;break;case 18:i.prev=18,i.t0=i.catch(0),t.world=void 0,t.worldLand=void 0,t.worldCountries=void 0,t.covidConfirmed=void 0,t.isDataFetched=!1;case 25:case"end":return i.stop()}}),i,null,[[0,18]])})))()},generateCountryToCountMap:function(t){var i=this;this.countryToCount={},this.minCount=void 0,this.maxCount=void 0,t.forEach((function(t){var e=t["Country/Region"].toLowerCase(),n=t[Object.keys(t).pop()];void 0===i.countryToCount[e]?i.countryToCount[e]=n:i.countryToCount[e]+=n,i.minCount=void 0===i.minCount?n:Math.min(i.minCount,n),i.maxCount=void 0===i.maxCount?n:Math.max(i.maxCount,n)}))},adjustDimensions:function(){console.log("Adjusting dimensions"),this.dimensions.screenWidth=document.documentElement.clientWidth,this.dimensions.screenHeight=document.documentElement.clientHeight,this.isMounted&&this.context.clearRect(0,0,this.width,this.height),this.dimensions.canvasSquareSide=Math.min(.95*this.dimensions.screenWidth-this.dimensions.canvasMargin,.7*this.dimensions.screenHeight-this.dimensions.canvasMargin)},getUniqueRGBColor:function(){var t=[];return this.nextUniqueColorSeed>16777214&&(this.nextUniqueColorSeed=1),t.push(255&this.nextUniqueColorSeed),t.push((65280&this.nextUniqueColorSeed)>>8),t.push((16711680&this.nextUniqueColorSeed)>>16),this.nextUniqueColorSeed+=5,"rgb("+t.join(",")+")"},setupEquirectangularColorKeys:function(){if(this.isMounted&&this.isDataFetched)for(var t=this.worldCountries.features.length;t--;){var i=this.worldCountries.features[t],e=this.getUniqueRGBColor();this.colorToCountry[e]=i,this.equirectangularContext.beginPath(),this.equirectangularPath(i),this.equirectangularContext.fillStyle=e,this.equirectangularContext.fill()}},getCountryFromEquirectangularImageData:function(t){var i=t.data,e="rgb("+i[0]+","+i[1]+","+i[2]+")";return this.colorToCountry[e]},configureInitialProjection:function(){this.projection.scale(this.scale),this.projection.rotate([this.rotations.yaw,this.rotations.pitch,this.rotations.roll])},selectCountryFromPosition:function(t){var i=this.projection.invert(t),e=this.equirectangularProjection(i);if(e[0]>-1){var n=this.equirectangularContext.getImageData(e[0],e[1],1,1),o=this.getCountryFromEquirectangularImageData(n);if(void 0===o)this.selectedCountry=void 0;else if(void 0===this.selectedCountry||this.selectedCountry.id!==o.id){this.selectedCountry=o;var s=this.selectedCountry.properties.name.toLowerCase(),a=this.countryToCount[s];void 0!==a&&(this.selectedCountry.properties.count=a)}}},rotateFromDragEvent:function(t){var i=this.projection.rotate(),e=this.dragSensitivity/this.projection.scale();this.rotations={yaw:i[0]+t.dx*e,pitch:i[1]-t.dy*e,roll:this.rotations.roll}},getDistanceBetweenTwoPoints:function(t){return Math.sqrt(Math.pow(t[0][0]-t[1][0],2)+Math.pow(t[0][1]-t[1][1],2))},scaleFromPinchTouches:function(t){if(this.lastPinchDistance){var i=this.getDistanceBetweenTwoPoints(t);if(i===this.lastPinchDistance)return;i>this.lastPinchDistance?this.scale=Math.min(1e4,this.scale*(1+this.pinchZoomSensitivity)):this.scale=Math.max(100,this.scale*(1-this.pinchZoomSensitivity))}this.lastPinchDistance=this.getDistanceBetweenTwoPoints(t)},onMouseMove:function(){var t=s.g(s.b.target);this.selectCountryFromPosition(t)},onZoom:function(){this.scale=this.radius*s.b.transform.k},onDragStart:function(){var t=s.l(s.b.sourceEvent.target);t.length<2?(this.isRotating=!this.isRotating,this.isBeingDragged=!0):2===t.length&&(this.lastPinchDistance=this.getDistanceBetweenTwoPoints(t))},onDrag:function(){var t=s.l(s.b.sourceEvent.target);t.length<2?this.rotateFromDragEvent(s.b):2===t.length&&this.scaleFromPinchTouches(t)},onDragEnd:function(){this.isBeingDragged&&(this.isRotating=!this.isRotating,this.isBeingDragged=!1)},render:function(){var t=this;this.context.clearRect(0,0,this.width,this.height),this.context.lineWidth=1.5,this.context.fillStyle=this.colors.water,this.context.beginPath(),this.path({type:"Sphere"}),this.context.fill(),this.context.stroke(),this.context.lineWidth=.3,this.worldCountries.features.forEach((function(i){var e,n=i.properties.name.toLowerCase(),o=t.countryToCount[n];if(void 0!==o){var s=t.countryColorScale(o);e="rgb(".concat(t.colors.landRed,",").concat(s,",").concat(s,")")}else e=t.colors.unavailableCountry;t.context.fillStyle=e,t.context.beginPath(),t.path(i),t.context.fill(),t.context.stroke()})),void 0!==this.selectedCountry&&(this.context.fillStyle=this.colors.selectedCountry,this.context.beginPath(),this.path(this.selectedCountry),this.context.fill())},draw:function(t){if(!this.isBeingDrawn&&this.isMounted&&this.isDataFetched){this.isBeingDrawn=!0;var i=s.h(),e=i-this.lastDrawLoopCallTime;e<t&&(this.isRotating&&(this.rotations={yaw:this.rotations.yaw+=e*this.autoRotationDegPerMilliSec,pitch:this.rotations.pitch,roll:this.rotations.roll}),this.render()),this.lastDrawLoopCallTime=i,this.isBeingDrawn=!1}}}},c=e(37),h=e(42),u=e.n(h),l=e(358),d=e(306),g=e(359),v=Object(c.a)(r,(function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("v-container",[e("v-row",{attrs:{align:"center",justify:"center"}},[e("v-col",{attrs:{align:"center"}},[t.isDataFetched?t._e():e("div",[t._v("\n        Fetching Data\n        "),e("span",{staticClass:"ml-2"},[e("font-awesome-icon",{attrs:{icon:["fas","spinner"],pulse:""}})],1)])])],1),t._v(" "),e("v-row",{attrs:{align:"center",justify:"center"}},[e("v-col",{attrs:{id:"canvasContainer",align:"center"}})],1),t._v(" "),e("v-row",{attrs:{align:"center",justify:"center"}},[e("v-col",{attrs:{align:"center"}},[void 0!==t.selectedCountry?e("div",[e("span",[t._v(t._s(t.selectedCountry.properties.name))]),t._v(" "),void 0!==t.selectedCountry.properties.count?e("span",[t._v(": "+t._s(t.selectedCountry.properties.count))]):t._e()]):t._e()])],1)],1)}),[],!1,null,null,null),C=v.exports;u()(v,{VCol:l.a,VContainer:d.a,VRow:g.a});var f={components:{Globe:C},data:function(){return{title:"Covid Athenaeum"}},head:function(){return{title:this.title,meta:[{hid:"description",name:"description",content:"Learn about COVID-19"}]}}},m=(e(354),Object(c.a)(f,(function(){var t=this.$createElement,i=this._self._c||t;return i("div",[i("Globe")],1)}),[],!1,null,null,null));i.default=m.exports}}]);